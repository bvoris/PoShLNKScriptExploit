# PoSh LNK Script Exploit

Created by: Brad Voris<BR />
<img alt="GitHub" src="https://img.shields.io/github/license/bvoris/PoShLNKScriptExploit">
<img alt="GitHub commit activity" src="https://img.shields.io/github/commit-activity/m/bvoris/PoShLNKScriptExploit">
<img alt="GitHub All Releases" src="https://img.shields.io/github/downloads/bvoris/PoShLNKScriptExploit/total">
<img alt="GitHub repo size" src="https://img.shields.io/github/repo-size/bvoris/PoShLNKScriptExploit">
<img alt="GitHub language count" src="https://img.shields.io/github/languages/count/bvoris/PoShLNKScriptExploit">
<img alt="GitHub issues" src="https://img.shields.io/github/issues/bvoris/PoShLNKScriptExploit">
<img alt="GitHub top language" src="https://img.shields.io/github/languages/top/bvoris/PoShLNKScriptExploit">

This isn't new and is continued to be leveraged by threat actors across the globe.<BR />
I'll demonstrate why LNK files should be blocked at the email level and if embedded in other files should be blocked by default.<BR />

We'll take a single line from an LNK file that executes PowerShell:<BR />
%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe<BR />



We will add the following:<BR />
-NoExit<BR />
-NoExit Prevents the window from exiting once the commands have been run<BR />

-c <BR />
-c executes commands directly following the -c<BR />

Now we can add ANY powerShell that can fit in the 255 character limit.<BR />

In my sample code we count down from 1 to 5 writing dots to the screen on a single line and waiting a second inbetween them. When the command ends it writes to the host Formatting C Drive Complete!... (Some bad humor on my part.)<BR />

%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe -NoExit -c 1..5 | foreach { write-host "." -NoNewline; sleep -sec 1} -end {write-host "Formatting C Drive Complete!" }

<img src="https://github.com/bvoris/PoShLNKScriptExploit/blob/main/images/whatitd01o.png">

Considering the 255 character limit its very easy to see how threat actors can use LNK files to auto-download a payload and execute. This is especially true with URL shorteners.<BR />

Inspiration for this project:<BR />
https://thehackernews.com/2023/05/north-koreas-scarcruft-deploys-rokrat.html?m=1<BR />
https://www.mcafee.com/blogs/other-blogs/mcafee-labs/rise-of-lnk-shortcut-files-malware/<BR />
  
## Connect with me at

<a href="https://twitter.com/HMInfoSecViking?ref_src=twsrc%5Etfw"><IMG SRC="https://github.com/bvoris/bvoris/blob/master/twitter.jpg" WIDTH=10% HEIGHT=10% ALIGN=LEFT></a>

<a href="https://www.linkedin.com/in/brad-voris" target="_blank"><IMG SRC="https://github.com/bvoris/bvoris/blob/master/linkedin.png" WIDTH=10% HEIGHT=4% ALIGN=RIGHT></a>
 
<BR /><BR />
<BR /><BR />

<A HREF="https://www.victimoftechnology.com">Victim Of Technology<A />
<BR /><BR />
<A HREF="https://www.cyberforgesecurity.com">Cyber Forge Security, Inc.<A />
<BR /><BR />
